# Документация модуля оплаты

> ОБРАТИТЕ ВНИМАНИЕ!
>
> Ключи показанные в руководстве **НЕ ПРЕДОСТАВЛЯЮТ ДОСТУПА К ФУНКЦИОНАЛУ**, но позволят Вам проверить правильность
> работы подписи в вашем приложении.
>
> Для работы с API необходимо быть зарегистрированным в сервисе
>

## Общая информация

* Все поля, связанные со временем указыватся с нулевым смещением (UTC+0) в формате *YYYY-MM-DD'T'hh:mm:ss*)<br>**Пример:
  ** 2023-08-20T13:51:00 (Московское время: 2023-08-20T16:51:00)
* API-ключи **чувствительны к регистру**.

## HTTP-коды возврата

| Код возврата | Описание                                                                                                                                                                                         |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 200          | Операция выполнена успешно, возвращается объект JSON                                                                                                                                             |
| 4XX          | Используются для некорректно сформированных запросов; проблема на стороне отправителя                                                                                                            |
| 401          | Используется при ошибке авторизации                                                                                                                                                              |
| 403          | Используется при ошибке доступа                                                                                                                                                                  |
| 5XX          | Используются для внутренних ошибок, проблема на стороне платежной системы. **Важно НЕ рассматривать это как неудачную операцию; состояние выполнения НЕИЗВЕСТНО и могло быть выполнено успешно** |

## Авторизация

* **Обязательно:** Для каждого запроса ВНЕ ЗАВИСИМОСТИ ОТ ТИПА добавляется штамп времени (текущее время в формате UTC),
  передается в параметре запроса timestamp.

> GET /api/orders?timestamp=2023-08-20T13:51:00

Для авторизации необходимо поместить следующие параметры в заголовок запроса:

| Заголовок | Содержание                  |
|-----------|-----------------------------|
| UID       | **Персональный ключ (UID)** |
| SIGNATURE | **MD5-хеш (SIGNATURE)**     |

* **Заголовки необходимо формировать для каждого запроса к API**
* **MD5-хеш формируется в зависимости от типа запроса (GET/POST)**
* Для расчета **MD5-хеша (SIGNATURE)** потребуется **персональный ключ (UID)** и **приватный ключ (PRIVATE_KEY)**. Их
  можно получить в личном кабинете.
* **ВНИМАНИЕ! PRIVATE_KEY ИСПОЛЬЗУЕТСЯ ТОЛЬКО ДЛЯ ПОДПИСИ ЗАПРОСА И В ЯВНОМ ВИДЕ НЕ ПЕРЕДАЕТСЯ!**
  <br>

### GET-запрос

| Параметр    | Описание                                                             | Пример                                                    |
|-------------|----------------------------------------------------------------------|-----------------------------------------------------------|
| UID         | Персональный ключ                                                    | <code>e7742caf-5e74-498c-8f4f-d4ae0a6f2bf3</code>         |
| PRIVATE_KEY | Приватный ключ                                                       | <code>GJI/1MP8MvE/ODbnplDlnaQb8ZYQb8ZYIVSg+II6xnA=</code> |
| PARAMS      | Является конкантенация всех параметров в формате "param1=a&param2=b" | <code>timestamp=2023-08-20T13:51:00&page=2</code>         |

Подписью является MD5-HASH("{UID}:{PRIVATE_KEY}:{PARAMS}")

Пример тела подписи для GET-запроса:

    e7742caf-5e74-498c-8f4f-d4ae0a6f2bf3:GJI/1MP8MvE/ODbnplDlnaQb8ZYQb8ZYIVSg+II6xnA=:timestamp=2024-05-04T12:14:07&pageNumber=0&pageSize=4

Полученная подпись md5

    6c5711fa920e460e88dee24e0e5d61cd

### POST-запрос

| Параметр    | Описание          | Пример                                                                                                                                             |
|-------------|-------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| UID         | Персональный ключ | <code>e7742caf-5e74-498c-8f4f-d4ae0a6f2bf3</code>                                                                                                  |
| PRIVATE_KEY | Приватный ключ    | <code>GJI/1MP8MvE/ODbnplDlnaQb8ZYQb8ZYIVSg+II6xnA=</code>                                                                                          |
| PAYLOAD     | Тело запроса      | <code>{"OrderId": "11111111232132","Amount": 10000,"CallbackUrl": "https://site.com/pay/result","ReturnUrl":"https://site.com/pay/success"}</code> |

Подписью является MD5-HASH("{UID}:{PRIVATE_KEY}:{PAYLOAD}")

Пример тела подписи для POST-запроса:

```
    e7742caf-5e74-498c-8f4f-d4ae0a6f2bf3:GJI/1MP8MvE/ODbnplDlnaQb8ZYQb8ZYIVSg+II6xnA=:{
    "externalId": "111111112321341",
    "amount": 100,
    "currency": "USD",
    "callbackUrl": "https://site.com/pay/result",
    "clientInfo": "User777"
}
```

Полученая подпись md5

    d56e3c322c0cbb51897593085f0fcf99

Все методы можно предоставить в виде postman коллекции, которую необходимо импортировать,
настроить переменные

| Переменная  | Описание               | Пример                                                    |
|-------------|------------------------|-----------------------------------------------------------|
| UID         | Персональный ключ      | <code>e7742caf-5e74-498c-8f4f-d4ae0a6f2bf3</code>         |
| PRIVATE_KEY | Приватный ключ         | <code>GJI/1MP8MvE/ODbnplDlnaQb8ZYQb8ZYIVSg+II6xnA=</code> |
| api_server  | URL сервиса интеграции | <code>https://url-payment-sercive.com/api</code>               |

Для всей коллекции описан скрипт подписи каждого запроса. При необходимости можно сверяться с генерируемыми значениями

---

## Методы оплаты/баланс

### Получить баланс

`GET /balance`

Пример запроса:
`/api/balance?timestamp=2024-05-04T12:30:07`

Ответ (статус код 200):

```
{
    "success": true,
    "result": {
        "amount": 1251.00
    }
}
```

### Получить доступные методы оплаты

`GET /payment_method_definitions`

Пример запроса:
`/api/payment_method_definitions?timestamp=2024-05-04T12:30:07`

Ответ (статус код 200):

```
{
    "success": true,
    "result": [
        {
            "id": "d53e3d2e-4f9e-4570-ad5c-0b7647e45e48",
            "name": "Банк США",
            "type": "BANK_CARD_TRANSFER",
            "currency": {
                "code": "USD",
                "name": "Доллар США",
                "isActive": true,
                "precision": 2
            }
        }
    ]
}
```

## Методы конвертации валюты

### Получить информацию о методе конвертации валюты по идентификатору метода конвертации

`GET /conversion_method/{methodCode}`

Пример запроса:
`/conversion_method/usd_to_rub?timestamp=2024-05-04T12:30:07`

Ответ (статус код 200):

```
{
    "id": "usd_to_rub",
    "currencyCodeFrom": "USD",
    "currencyCodeTo": "RUB",
    "conversionFactor": 0.0110000000
}
```
В ответе возвращается информация о методе конвертации валюты.

* `id` - идентификатор метода конвертации
* `currencyCodeFrom` - код валюты, из которой выполняется конвертация
* `currencyCodeTo` - код валюты, в которую выполняется конвертация
* `conversionFactor` - коэффициент конвертации

## Методы для работы с заявками приема средств

### Создать фиатную заявку приема средств

`POST /order`

* Опционально можно указать идентификатор заявки `paymentMethodDefinitionId` чтобы создать заявку с выбранным методом
  оплаты.

* Желательно указывать информацию о клиенте в поле "ClientInfo".

* В случае успеха, возвращается информация о заявке.

* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

**Параметры:** Штамп времени в строке запроса

Тело запроса:

| Параметр                  | Тип     | Обязательный | Примечание                  |
|---------------------------|---------|--------------|-----------------------------|
| externalId                | string  | Да           | Внешний ключ заявки         |
| amount                    | decimal | Да           | Сумма заявки                |
| currency                  | string  | Да           | Код валюты заявки           |
| callbackUrl               | string  | Нет          | URL оповещения              |
| clientInfo                | string  | Нет          | Информация о клиенте        |
| paymentMethodDefinitionId | string  | Нет          | Идентификатор метода оплаты |
| type                      | string  | Нет          | Тип метода оплаты           |
| conversionMethod          | string  | Нет          | Тип метода конвертации      |

Тип метода оплаты может принимать следующие значения

```
BANK_CARD_TRANSFER - перевод на банковскую карту
TRANSFER_BY_NUMBER - перевод по номеру телефона
```

Пример запроса:
`/api/order?timestamp=2024-05-04T12:38:25`

#### Создание заявки

```<json>   
{
    "externalId": "111111112321341",
    "amount": 100,
    "currency": "USD",
    "callbackUrl": "https://site.com/pay/result",
    "clientInfo": "User777",
    "type": "BANK_CARD_TRANSFER"
}
```

#### Создание заявки с выбором метода оплаты `paymentMethodDefinitionId`

```<json>
{
  "externalId": "11111111232132",
  "amount": 10.5,
  "currency": "RUB",
  "callbackUrl": "https://site.com/pay/result",
  "clientInfo": "User777",
  "paymentMethodDefinitionId": "55422a79-59f7-4bab-b3dc-1b2242c2dac7"
}
```

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": {
        "hash": "a7efd403-7d89-4b3c-9111-b5e3c79528e6",
        "externalId": "111111112321341",
        "amount": 100.00,
        "details": {
            "phoneNumber": "1",
            "cardNumber": "2"
        },
        "callbackUrl": "https://site.com/pay/result",
        "clientInfo": "User777",
        "paymentMethod": {
            "id": "d53e3d2e-4f9e-4570-ad5c-0b7647e45e48",
            "name": "Банк США",
            "type": "BANK_CARD_TRANSFER",
            "currency": {
                "code": "USD",
                "name": "Доллар США",
                "isActive": true,
                "precision": 2
            }
        },
        "createdAt": "2024-05-04T15:34:55.56096812+03:00",
        "status": "PENDING"
    }
}
```

<span id="описание_заявки">Описание заявки</span>

В ответе возвращается информация по заявке.

* `hash` - идентификатор присвоенный заявке в нашей системе
* `externalId` - идентификатор переданный внешней системой
* `details` - информация о реквизитах. В зависимости от типа оплаты будет указан номер карты `cardNumber` и\или номер
  телефона `phoneNumber` по которым необходимо совершить платеж
* `paymentMethod` - информация о назначенном методе оплаты
* `status` - статус заявки

статус может быть

```
PENDING - исполняется
SUCCESS - успешно,
CANCELED - отклонена,
EXPIRED - истекла
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Валюта не найдена в системе"
        },
        {
            "errorType": "VALIDATION",
            "message": "Метод оплаты не найден в системе"
        }
    ]
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "FAILED_SELECT_PAYMENT_METHOD",
            "message": "Не удалось выделить реквизит"
        }
    ]
}
```

### Подтвердить фиатную заявку

`POST /order/{hash}/confirm`

* Используется в случае, когда пользователь оплатил заявку по реквизитам и подтверждает это

* Для функционирования системы необязательный параметр. Служит только для информирования

* Тело запроса пустое

* Параметр `hash` указывается в строке запроса

Пример запроса:
`/api/order/a7efd403-7d89-4b3c-9111-b5e3c79528e6/confirm?timestamp=2024-05-04T13:24:42`

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": "OK"
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заявка уже подтверждена клиентом"
        }
    ]
}
```

### Получить фиатную заявку по хешу

`GET /order/{hash}`

* В случае успеха, возвращается информация о заявке.

* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

* Параметр `hash` указывается в строке запроса

Пример запроса:
`/api/order/a7efd403-7d89-4b3c-9111-b5e3c79528e6?timestamp=2024-05-04T13:24:42`

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": {
        "hash": "71ac21c7-d65b-47dd-89ad-17a441cb7838",
        "externalId": "111111112321344",
        "amount": 100.0000000000,
        "details": {
            "phoneNumber": "1",
            "cardNumber": "2"
        },
        "callbackUrl": "https://site.com/pay/result",
        "clientInfo": "User777",
        "paymentMethod": {
            "id": "d53e3d2e-4f9e-4570-ad5c-0b7647e45e48",
            "name": "Банк США",
            "type": "BANK_CARD_TRANSFER",
            "currency": {
                "code": "USD",
                "name": "Доллар США",
                "isActive": true,
                "precision": 2
            }
        },
        "createdAt": "2024-05-04T13:32:06.505575Z",
        "status": "PENDING"
    }
}
```

[Описание заявки](#описание_заявки) можно посмотреть выше

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заявка по хэшу не найдена в системе"
        }
    ]
}
```

### Получить фиатную заявку по внешнему ключу

`GET /order/ext/{externalId}`

* В случае успеха, возвращается информация о заявке.

* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

* Параметр `externalId` указывается в строке запроса

Пример запроса:
`/api/order/ext/111111112321344?timestamp=2024-05-04T13:43:28`

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": {
        "hash": "71ac21c7-d65b-47dd-89ad-17a441cb7838",
        "externalId": "111111112321344",
        "amount": 100.0000000000,
        "details": {
            "phoneNumber": "1",
            "cardNumber": "2"
        },
        "callbackUrl": "https://site.com/pay/result",
        "clientInfo": "User777",
        "paymentMethod": {
            "id": "d53e3d2e-4f9e-4570-ad5c-0b7647e45e48",
            "name": "Банк США",
            "type": "BANK_CARD_TRANSFER",
            "currency": {
                "code": "USD",
                "name": "Доллар США",
                "isActive": true,
                "precision": 2
            }
        },
        "createdAt": "2024-05-04T13:32:06.505575Z",
        "status": "PENDING"
    }
}
```

[Описание заявки](#описание_заявки) можно посмотреть выше

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заявка по внешнему ID не найдена в системе"
        }
    ]
}
```

### Получить фиатные заявки по фильтру

`GET /order`

* Все фильтры указываются в параметрах запроса
* Из обязательных параметров только `timestamp`
* В этом методе поддерживается механизм пагинации. За это отвечают параметры `pageNumber` и `pageSize`
* В этом методе поддерживается механизм сортировки совместно с пагинацией. За это отвечают параметры `fieldNameSort`
  и `isDescSort`
* В случае успеха, возвращаются заявки в формате:

```json
{
  "success": true,
  "result": {
    "elements": [
      ...
    ],
    "totalElements": 2,
    "totalPages": 1,
    "currentPages": 0
  }
}
```

| Свойство      | Описание                                              |
|---------------|-------------------------------------------------------|
| elements      | массив заявок который описан [выше](#описание_заявки) |
| totalElements | общее количество найденных элементов                  |
| totalPages    | общее количество страниц размера `pageSize`           |
| currentPages  | текущая страница                                      |

Параметры запроса

**Параметры:** Штамп времени в строке запроса

| Параметр      | Тип      | Обязательный | Примечание                           |
|---------------|----------|--------------|--------------------------------------|
| timestamp     | DateTime | Да           | Штамп времени                        |
| hash          | string   | Нет          | Отфильтровать по хешу заявки         |
| amountMin     | decimal  | Нет          | Фильтр нижней границы суммы          |
| amountMax     | decimal  | Нет          | Фильтр верхней границы суммы         |
| currency      | string   | Нет          | Фильтр по валюте                     |
| createdAfter  | DateTime | Нет          | Фильтр нижней границы даты создания  |
| createdBefore | DateTime | Нет          | Фильтр верхней границы даты создания |
| orderStatus   | string   | Нет          | Статус заявки                        |
| pageNumber    | int      | Нет          | Номер страницы                       |
| pageSize      | int      | Нет          | Размер страницы                      |
| fieldNameSort | string   | Нет          | Поле сортировки                      |
| isDescSort    | boolean  | Нет          | Направление сортировки               |

`orderStatus` может быть множественный - можно указать несколько статусов например `CANCELED` и `EXPIRED` и принимает
значения

```
PENDING - исполняется
SUCCESS - успешно,
CANCELED - отклонена,
EXPIRED - истекла
```

Пример запроса:
`/api/order?timestamp=2024-05-04T13:55:11&orderStatus=PENDING&pageNumber=1&pageSize=10&fieldNameSort=externalId`

Получает с 11 по 20 (`pageNumber=1&pageSize=10`) необработанные заявки (`orderStatus=PENDING`) отсортированные по ключу
внешней заявки (`fieldNameSort=externalId`)

## Уведомления

Мы работаем с системой уведомлений, которая уведомляет ваш сервис об изменении статуса транзакции.

Существует 10 попыток уведомлений, которые повторяются через определенный интервал времени.

Если вы получили статус, то обязательно верните код 200, чтобы система больше не отправляла уведомления по заявке.

### Как работает обратный вызов?

Прежде всего, при создании заявки вы получите идентификатор HASH, в котором указан идентификатор в нашей системе.

Когда статус транзакции будет изменен, вы получите обратные вызовы на адрес указанный при создании заявки.

Если в личном кабинете был указан адрес обратного вызова, то если при создании заявки будет передан `callbackUrl` -
вызов будет осуществляться на переданный в `callbackUrl` адрес
если `callbackUrl` не был передан, то берется значение из личного кабинета. Если нигде не удалось найти адрес обратного
вызова, то при изменении статуса заявки уведомления не отправляются

На найденный адрес отправляется **POST**-запрос с телом заявки, в формате, который описан [выше](#описание_заявки)

пример:

```json
{
  "hash": "a7efd403-7d89-4b3c-9111-b5e3c79528e6",
  "externalId": "111111112321341",
  "amount": 100.00,
  "details": {
    "phoneNumber": "1",
    "cardNumber": "2"
  },
  "callbackUrl": "https://site.com/pay/result",
  "clientInfo": "User777",
  "paymentMethod": {
    "id": "d53e3d2e-4f9e-4570-ad5c-0b7647e45e48",
    "name": "Банк США",
    "type": "BANK_CARD_TRANSFER",
    "currency": {
      "code": "USD",
      "name": "Доллар США",
      "isActive": true,
      "precision": 2
    }
  },
  "createdAt": "2024-05-04T15:34:55.56096812+03:00",
  "status": "PENDING"
}
```

Запрос подписывается ключом api и секретом, по аналогии авторизации для вызова методов апи

Для проверки корректности информации, **обязательно!** проверяйте хеш модели с хешем из заголовка "SIGNATURE"

Варианты статуса заявки:

```
PENDING - исполняется
SUCCESS - успешно,
CANCELED - отклонена,
EXPIRED - истекла
```

## Методы заявок на выплату

### Создать заявку на выплату средств

`POST /payout`

* Желательно указывать информацию о методе выплаты(название банка, электронного кошелька, итд) в поле "payoutMethod" - (
  строка).

* В случае успеха, возвращается информация о выплате.

* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

* Параметр `payoutExpirationDate` необходимо отправлять в формате MM/YY

**Параметры:** Штамп времени в строке запроса

Тело запроса:

| Параметр             | Тип     | Обязательный | Примечание                                                                                           |
|----------------------|---------|--------------|------------------------------------------------------------------------------------------------------|
| externalId           | string  | Да           | Внешний ключ выплаты                                                                                 |
| amount               | decimal | Да           | Сумма выплаты                                                                                        |
| currency             | string  | Да           | Код валюты выплаты                                                                                   |
| callbackUrl          | string  | Нет          | URL оповещения                                                                                       |
| payoutMethod         | string  | Нет          | Информация о методе выплаты(название банка итд)                                                      |
| payoutInfo           | string  | Да           | Реквизиты для выплаты(номер карты, телефона итд)                                                     |
| payoutExpirationDate | string  | Нет          | Дата окончания действия карты(необходима, когда способ выплаты требует это значение). Формат `MM/YY` |

Пример запроса:
`/api/payout?timestamp=2024-05-04T12:38:25`

#### Создание выплаты

```<json>   
{
    "externalId": "102",
    "amount": 10,
    "currency": "USD",
    "callbackUrl": "https://site.com/pay/result",
    "payoutMethod": "Тинькофф",
    "payoutInfo": "4644 4654 4546 3133",
    "payoutExpirationDate": "05/29"
}
```

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": {
        "hash": "8d71eb70-6e4c-48dd-b32c-99db11907ee3",
        "externalId": "102",
        "amount": 10.00,
        "callbackUrl": "https://site.com/pay/result",
        "createdAt": "2024-05-17T16:09:29.492512093+03:00",
        "status": "PENDING"
    }
}
```

В ответе возвращается информация по выплате.

* `hash` - идентификатор присвоенный выплате в нашей системе
* `externalId` - идентификатор переданный внешней системой
* `status` - статус выплаты

статус может быть

```
PENDING - исполняется
SUCCESS - успешно,
CANCELED - отклонена,
EXPIRED - истекла
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Валюта не найдена в системе"
        }
    ]
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "FAILED_SELECT_PAYMENT_METHOD",
            "message": "Не удалось выделить реквизит"
        }
    ]
}
```

### Получить выплату по хешу

`GET /payout/{hash}`

* В случае успеха, возвращается информация о выплате.

* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

* Параметр `hash` указывается в строке запроса

Пример запроса:
`/api/payout/a7efd403-7d89-4b3c-9111-b5e3c79528e6?timestamp=2024-05-04T13:24:42`

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": {
        "hash": "8d71eb70-6e4c-48dd-b32c-99db11907ee3",
        "externalId": "102",
        "amount": 10.00,
        "callbackUrl": "https://site.com/pay/result",
        "createdAt": "2024-05-17T16:09:29.492512093+03:00",
        "status": "PENDING"
    }
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заявка по хэшу не найдена в системе"
        }
    ]
}
```

### Получить выплату по внешнему ключу

`GET /payout/ext/{externalId}`

* В случае успеха, возвращается информация о выплате.

* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

* Параметр `externalId` указывается в строке запроса

Пример запроса:
`/api/payout/ext/111111112321344?timestamp=2024-05-04T13:43:28`

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": {
        "hash": "8d71eb70-6e4c-48dd-b32c-99db11907ee3",
        "externalId": "102",
        "amount": 10.00,
        "callbackUrl": "https://site.com/pay/result",
        "createdAt": "2024-05-17T16:09:29.492512093+03:00",
        "status": "PENDING"
    }
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заявка по внешнему ID не найдена в системе"
        }
    ]
}
```

### Получить выплаты по фильтру

`GET /payout`

* Все фильтры указываются в параметрах запроса
* Из обязательных параметров только `timestamp`
* В этом методе поддерживается механизм пагинации. За это отвечают параметры `pageNumber` и `pageSize`
* В этом методе поддерживается механизм сортировки совместно с пагинацией. За это отвечают параметры `fieldNameSort`
  и `isDescSort`
* В случае успеха, возвращаются выплаты в формате:

```json
{
  "success": true,
  "result": {
    "elements": [
      ...
    ],
    "totalElements": 2,
    "totalPages": 1,
    "currentPages": 0
  }
}
```

| Свойство      | Описание                                    |
|---------------|---------------------------------------------|
| elements      | массив выплат который описан выше           |
| totalElements | общее количество найденных элементов        |
| totalPages    | общее количество страниц размера `pageSize` |
| currentPages  | текущая страница                            |

Параметры запроса

**Параметры:** Штамп времени в строке запроса

| Параметр      | Тип      | Обязательный | Примечание                           |
|---------------|----------|--------------|--------------------------------------|
| timestamp     | DateTime | Да           | Штамп времени                        |
| hash          | string   | Нет          | Отфильтровать по хешу выплаты        |
| amountMin     | decimal  | Нет          | Фильтр нижней границы суммы          |
| amountMax     | decimal  | Нет          | Фильтр верхней границы суммы         |
| currency      | string   | Нет          | Фильтр по валюте                     |
| createdAfter  | DateTime | Нет          | Фильтр нижней границы даты создания  |
| createdBefore | DateTime | Нет          | Фильтр верхней границы даты создания |
| orderStatus   | string   | Нет          | Статус выплаты                       |
| pageNumber    | int      | Нет          | Номер страницы                       |
| pageSize      | int      | Нет          | Размер страницы                      |
| fieldNameSort | string   | Нет          | Поле сортировки                      |
| isDescSort    | boolean  | Нет          | Направление сортировки               |

`orderStatus` может быть множественный - можно указать несколько статусов например `CANCELED` и `EXPIRED` и принимает
значения

```
PENDING - исполняется
SUCCESS - успешно,
CANCELED - отклонена,
EXPIRED - истекла
```

Пример запроса:
`/api/payout?timestamp=2024-05-04T13:55:11&orderStatus=PENDING&pageNumber=1&pageSize=10&fieldNameSort=externalId`

Получает с 11 по 20 (`pageNumber=1&pageSize=10`) необработанные выплаты (`orderStatus=PENDING`) отсортированные по ключу
внешней выплаты (`fieldNameSort=externalId`)

-----------------------------------------------------

## Эквайринг

Эквайринг представляет собой заявку приема средств (PAY IN) со следующими шагами:

* Клиент вводит реквизиты своей карты
* Система создает заявку на снятие средств у клиента по переданным реквизитам
* Клиент передает 3ds-код
* Система вводит полученный от клиента код и подтверждает прием средств

Пояснения:

* Реализованы 2 варианта получения данных карты клиента: хост-хост -`h2h` и оплата через форму - `payform`. Отличие
  в них
  только на первом этапе создания заявки и передачи данных о карте.
* В случае `h2h` при создании заявки передаются данные карты клиента и сумма.
* В случае `payform` при создании заявки опционально передается сумма, в этом случае необходимо перенаправить
  клиента на нашу форму, в которой он укажет данные карты и если необходимо - сумму
* В информации о заявке присутствует поле `payFormUrl` здесь указывается адрес на который можно направить клиента.
* После завершения обработки заявки клиент с пейформы буден перенаправлен на адрес `redirectUrl` указанный при создании
  заявки
* В случае `h2h` так же можно воспользоваться формой оплаты, но поскольку данные были переданы при создании запроса
  функционально клиент сможет только ввести 3ds код на форме на соответствующем этапе.

Флоу для `h2h` по статусам:

```
DETAILS_RECEIVED - создана заявка и получены данные карты пользователя в одном запросе
WAITING_CODE - система обработала данные карты пользователя и теперь ожидает 3ds код от пользователя
CODE_RECEIVED - 3ds код получен от пользователя
SUCCESS - заявка закрыта успешно
CANCELED - заявка закрыта НЕуспешно
```

Флоу для `payform` по статусам:

```
CREATED - создана заявка
DETAILS_RECEIVED - системой получены данные карты пользователя 
WAITING_CODE - система обработала данные карты пользователя и теперь ожидает 3ds код от пользователя
CODE_RECEIVED - 3ds код получен от пользователя
SUCCESS - заявка закрыта успешно
CANCELED - заявка закрыта НЕуспешно
```

### Создать заявку (h2h flow)

`POST /acquiring`

* В случае успеха, возвращается информация о заявке.
* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

**Параметры:** Штамп времени в строке запроса

Тело запроса:

| Параметр           | Тип     | Обязательный | Примечание                                                                                             |
|--------------------|---------|--------------|--------------------------------------------------------------------------------------------------------|
| externalId         | string  | Да           | Внешний ключ заявки                                                                                    |
| amount             | decimal | Да           | Сумма заявки                                                                                           |
| currency           | string  | Да           | Код валюты заявки                                                                                      |
| callbackUrl        | string  | Нет          | URL оповещения                                                                                         |
| redirectUrl        | string  | Нет          | URL перенаправления пользователя после оплаты на форме                                                 |
| clientInfo         | string  | Нет          | Информация о клиенте(опциональная информация о клиенте)                                                |
| cardNumber         | string  | Да           | Номер карты. Включена валидация на номер карты - необходимо направлять только существующий номер карты |
| cardExpirationDate | string  | Да           | Дата окончания действия карты. Формат `MM/YY`                                                          |
| cardHolder         | string  | Да           | Держатель карты                                                                                        |
| cardCvv            | string  | Да           | CVV код карты                                                                                          |

Пример запроса:
`/api/acquiring?timestamp=2024-05-04T12:38:25`

#### Создание заявки

```<json>   
{
    "externalId": "37",
    "amount": 100,
    "currency": "USD",
    "callbackUrl": "https://site.com/pay/result",
    "redirectUrl": "https://site.com/redirectUrl",
    "clientInfo": "User777",
    "cardNumber": "1234123412341234",
    "cardExpirationDate": "12/2025",
    "cardHolder": "IVAN IVANOV",
    "cardCvv": "123"
}
```

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": {
        "hash": "01dd1a6d-538a-4c4d-bb38-bc128d39f528",
        "externalId": "37",
        "currencyCode": "USD",
        "amount": 100.00,
        "callbackUrl": "https://site.com/pay/result",
        "redirectUrl": "https://site.com/redirectUrl",
        "payFormUrl": "site-pay.com/?id=01dd1a6d-538a-4c4d-bb38-bc128d39f528",
        "clientInfo": "User777",
        "createdAt": "2024-06-28T15:45:02.968357964+03:00",
        "status": "DETAILS_RECEIVED",
        "cardNumber": "123412******1234"
    }
}
```

В ответе возвращается информация по заявке.

* `hash` - идентификатор присвоенный заявке в нашей системе
* `externalId` - идентификатор переданный внешней системой
* `status` - статус заявки `DETAILS_RECEIVED`

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Валюта не найдена в системе"
        }
    ]
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заявка с внешним идентификатором 36 уже существует в системе"
        }
    ]
}
```

### Создать заявку (payform flow)

`POST /acquiring/cardless`

* Поле `amount` - необязательно.

* В случае успеха, возвращается информация о заявке.

* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

**Параметры:** Штамп времени в строке запроса

Тело запроса:

| Параметр    | Тип     | Обязательный | Примечание                                              |
|-------------|---------|--------------|---------------------------------------------------------|
| externalId  | string  | Да           | Внешний ключ заявки                                     |
| amount      | decimal | Нет          | Сумма заявки                                            |
| currency    | string  | Да           | Код валюты заявки                                       |
| callbackUrl | string  | Нет          | URL оповещения                                          |
| redirectUrl | string  | Нет          | URL перенаправления пользователя после оплаты на форме  |
| clientInfo  | string  | Нет          | Информация о клиенте(опциональная информация о клиенте) |

Пример запроса:
`/api/acquiring?timestamp=2024-05-04T12:38:25`

#### Создание заявки

```<json>   
{
    "externalId": "37",
    "amount": 100,
    "currency": "USD",
    "callbackUrl": "https://site.com/pay/result",
    "redirectUrl": "https://site.com/redirectUrl",
    "clientInfo": "User777"
}
```

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": {
        "hash": "01dd1a6d-538a-4c4d-bb38-bc128d39f528",
        "externalId": "37",
        "currencyCode": "USD",
        "amount": 100.00,
        "callbackUrl": "https://site.com/pay/result",
        "redirectUrl": "https://site.com/redirectUrl",
        "payFormUrl": "site-pay.com/?id=01dd1a6d-538a-4c4d-bb38-bc128d39f528",
        "clientInfo": "User777",
        "createdAt": "2024-06-28T15:45:02.968357964+03:00",
        "status": "CREATED"
    }
}
```

В ответе возвращается информация по заявке.

* `hash` - идентификатор присвоенный заявке в нашей системе
* `externalId` - идентификатор переданный внешней системой
* `status` - статус заявки `CREATED`

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Валюта не найдена в системе"
        }
    ]
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заявка с внешним идентификатором 36 уже существует в системе"
        }
    ]
}
```

### Передать данные карты пользователя (payform flow) (Данные)

`POST /acquiring/send_card_data`

* Поле `amount` - условно-обязательно: должно быть обязательно передано, если сумма операции (`amount`) не была передана
  при формировании заявки методом `POST /acquiring/cardless`

* В случае успеха, возвращается информация о заявке.

* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

**Параметры:** Штамп времени в строке запроса

Тело запроса:

| Параметр           | Тип     | Обязательный | Примечание                                                                                             |
|--------------------|---------|--------------|--------------------------------------------------------------------------------------------------------|
| id                 | string  | Да           | Хэш заявки                                                                                             |
| amount             | decimal | Нет          | Сумма заявки                                                                                           |
| cardNumber         | string  | Да           | Номер карты. Включена валидация на номер карты - необходимо направлять только существующий номер карты |
| cardExpirationDate | string  | Да           | Дата окончания действия карты. Формат `MM/YY`                                                          |
| cardHolder         | string  | Да           | Держатель карты                                                                                        |
| cardCvv            | string  | Да           | CVV код карты                                                                                          |

Пример запроса:
`/api/acquiring?timestamp=2024-05-04T12:38:25`

#### Создание заявки

```<json>   
{
    "externalId": "37",
    "amount": 100,
    "currency": "USD",
    "callbackUrl": "https://site.com/pay/result",
    "payFormUrl": "site-pay.com/?id=01dd1a6d-538a-4c4d-bb38-bc128d39f528",
    "clientInfo": "User777"
}
```

Ответ (статус код 200):

```<json>
{
    "success": true,
    "result": {
        "hash": "01dd1a6d-538a-4c4d-bb38-bc128d39f528",
        "externalId": "37",
        "currencyCode": "USD",
        "amount": 100.00,
        "callbackUrl": "https://site.com/pay/result",
        "redirectUrl": "https://site.com/redirectUrl",
        "payFormUrl": "site-pay.com/?id=01dd1a6d-538a-4c4d-bb38-bc128d39f528",
        "clientInfo": "User777",
        "createdAt": "2024-06-28T15:45:02.968357964+03:00",
        "status": "DETAILS_RECEIVED",
        "cardNumber": "123412******1234"
    }
}
```

В ответе возвращается информация по заявке.

* `hash` - идентификатор присвоенный заявке в нашей системе
* `externalId` - идентификатор переданный внешней системой
* `status` - статус заявки `DETAILS_RECEIVED`

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Дата действия карты истекла"
        }
    ]
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заказ не найден в системе"
        }
    ]
}
```

### Передать 3ds код по заявке

`POST /acquiring/code`

**Параметры:** Штамп времени в строке запроса

Тело запроса:

| Параметр | Тип    | Обязательный | Примечание |
|----------|--------|--------------|------------|
| hash     | string | Да           | Хэш заявки |
| code     | string | Да           | 3ds код    |

Пример запроса:
`/api/acquiring?timestamp=2024-05-04T13:24:42`

```<json>   
{
    "hash": "01dd1a6d-538a-4c4d-bb38-bc128d39f528",
    "code": "123456"
}
```

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": "OK"
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заявка должна быть в статусе WAITING_CODE"
        }
    ]
}
```

### Получить заявку по хешу

`GET /acquiring/{hash}`

* В случае успеха, возвращается информация о заявке.

* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

* Параметр `hash` указывается в строке запроса

Пример запроса:
`/api/acquiring/01dd1a6d-538a-4c4d-bb38-bc128d39f528?timestamp=2024-05-04T13:24:42`

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": {
        "hash": "01dd1a6d-538a-4c4d-bb38-bc128d39f528",
        "externalId": "37",
        "currencyCode": "USD",
        "amount": 100.0000000000,
        "callbackUrl": "https://site.com/pay/result",
        "redirectUrl": "https://site.com/redirectUrl",
        "payFormUrl": "site-pay.com/?id=01dd1a6d-538a-4c4d-bb38-bc128d39f528",
        "clientInfo": "User777",
        "createdAt": "2024-06-28T12:45:02.968358Z",
        "status": "DETAILS_RECEIVED",
        "cardNumber": "123412******1234"
    }
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заявка по хэшу не найдена в системе"
        }
    ]
}
```

### Получить заявку по внешнему ключу

`GET /acquiring/ext/{externalId}`

* В случае успеха, возвращается информация о заявке.

* В процессе обработки могут происходить ошибки. В это случае ответ будет с кодом 4XX и текстом ошибки

* Параметр `externalId` указывается в строке запроса

Пример запроса:
`/api/acquiring/ext/37?timestamp=2024-05-04T13:43:28`

Ответ (статус код 200):

```<json>   
{
    "success": true,
    "result": {
        "hash": "01dd1a6d-538a-4c4d-bb38-bc128d39f528",
        "externalId": "37",
        "currencyCode": "USD",
        "amount": 100.0000000000,
        "callbackUrl": "https://site.com/pay/result",
        "redirectUrl": "https://site.com/redirectUrl",
        "payFormUrl": "site-pay.com/?id=01dd1a6d-538a-4c4d-bb38-bc128d39f528",
        "clientInfo": "User777",
        "createdAt": "2024-06-28T12:45:02.968358Z",
        "status": "DETAILS_RECEIVED",
        "cardNumber": "123412******1234"
    }
}
```

Ответ (статус код 4XX):

```<json>   
{
    "success": false,
    "error": [
        {
            "errorType": "VALIDATION",
            "message": "Заявка по внешнему ID не найдена в системе"
        }
    ]
}
```

### Получить заявки по фильтру

`GET /acquiring`

* Все фильтры указываются в параметрах запроса
* Из обязательных параметров только `timestamp`
* В этом методе поддерживается механизм пагинации. За это отвечают параметры `pageNumber` и `pageSize`
* В этом методе поддерживается механизм сортировки совместно с пагинацией. За это отвечают параметры `fieldNameSort`
  и `isDescSort`
* В случае успеха, возвращаются заявки в формате:

```json
{
  "success": true,
  "result": {
    "elements": [
      ...
    ],
    "totalElements": 2,
    "totalPages": 1,
    "currentPages": 0
  }
}
```

| Свойство      | Описание                                    |
|---------------|---------------------------------------------|
| elements      | массив заявок который описан выше           |
| totalElements | общее количество найденных элементов        |
| totalPages    | общее количество страниц размера `pageSize` |
| currentPages  | текущая страница                            |

Параметры запроса

**Параметры:** Штамп времени в строке запроса

| Параметр      | Тип      | Обязательный | Примечание                           |
|---------------|----------|--------------|--------------------------------------|
| timestamp     | DateTime | Да           | Штамп времени                        |
| hash          | string   | Нет          | Отфильтровать по хешу заявки         |
| amountMin     | decimal  | Нет          | Фильтр нижней границы суммы          |
| amountMax     | decimal  | Нет          | Фильтр верхней границы суммы         |
| currency      | string   | Нет          | Фильтр по валюте                     |
| createdAfter  | DateTime | Нет          | Фильтр нижней границы даты создания  |
| createdBefore | DateTime | Нет          | Фильтр верхней границы даты создания |
| orderStatus   | string   | Нет          | Статус заявки                        |
| pageNumber    | int      | Нет          | Номер страницы                       |
| pageSize      | int      | Нет          | Размер страницы                      |
| fieldNameSort | string   | Нет          | Поле сортировки                      |
| isDescSort    | boolean  | Нет          | Направление сортировки               |

`orderStatus` может быть множественный - можно указать несколько статусов например `SUCCESS` и `CODE_RECEIVED`

Пример запроса:
`/api/acquiring?timestamp=2024-05-04T13:55:11&orderStatus=PENDING&pageNumber=1&pageSize=10&fieldNameSort=externalId`

Получает с 11 по 20 (`pageNumber=1&pageSize=10`) успешные заявки (`orderStatus=SUCCESS`) отсортированные по
внешнему ключу
заявки (`fieldNameSort=externalId`)
